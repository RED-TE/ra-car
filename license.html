<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¼ì´ì„ ìŠ¤ í™•ì¸ - ë¦¬ì¹´ì˜¤í† í”Œëœ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="base.css" rel="stylesheet">
    <script src="common.js"></script>
</head>

<body class="flex flex-col min-h-screen bg-slate-950">
    <div class="flex-grow flex items-center justify-center p-4">
        <div class="max-w-lg w-full relative">
            <a href="/" class="absolute top-6 right-6 text-gray-500 hover:text-white">âœ•</a>

            <div class="text-center mb-10">
                <h1 class="text-3xl font-black text-white mb-3">ë‚´ êµ¬ë… ì •ë³´</h1>
                <p class="text-gray-400">í˜„ì¬ ì´ìš© ì¤‘ì¸ í”Œëœê³¼ ê³„ì • ìƒíƒœì…ë‹ˆë‹¤.</p>
            </div>

            <div id="no-license" class="hidden text-center py-10 bg-slate-900/50 rounded-2xl border border-slate-800">
                <p class="text-gray-400 mb-6 text-lg">ì´ìš© ì¤‘ì¸ ìœ ë£Œ í”Œëœì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <button onclick="location.href='/checkout'" class="btn-primary px-8 py-3 text-lg">êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°</button>
            </div>

            <div id="license-info" class="hidden space-y-6">

                <!-- Plan Status Card -->
                <div
                    class="bg-gradient-to-b from-slate-800/80 to-slate-900/80 border border-slate-700 rounded-3xl p-8 text-center relative overflow-hidden shadow-2xl backdrop-blur-sm">
                    <!-- Top Glow -->
                    <div class="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-blue-500 via-green-400 to-blue-500">
                    </div>
                    <div class="absolute inset-x-0 top-0 h-20 bg-green-500/10 blur-xl"></div>

                    <h3 class="text-blue-400 text-xs font-bold tracking-[0.2em] mb-4 uppercase">Current Plan</h3>
                    <div class="text-4xl font-black text-white mb-3 tracking-tight drop-shadow-lg" id="plan-name">...
                    </div>

                    <div
                        class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-bold bg-green-500/10 text-green-400 border border-green-500/20 shadow-[0_0_10px_rgba(74,222,128,0.2)]">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        ACTIVE (ì‚¬ìš© ê°€ëŠ¥)
                    </div>

                    <p class="mt-4 text-xs text-gray-400">
                        ì´ìš© ë§Œë£Œì¼: <span id="expiry-display" class="font-bold text-gray-200">ë¡œë”© ì¤‘...</span>
                    </p>

                    <div class="mt-8 pt-6 border-t border-white/10">
                        <p class="text-gray-300 text-sm mb-3 font-bold">ğŸ’¡ ì´ìš© ë°©ë²•</p>
                        <p class="text-sm text-gray-400 leading-relaxed font-light">
                            í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ì‹  ë’¤,<br>
                            ì•„ë˜ í‘œì‹œëœ <strong class="text-white font-medium">ê³„ì • ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸</strong>í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>

                <!-- Account Info -->
                <div
                    class="bg-slate-900/80 rounded-2xl p-5 border border-slate-800 flex justify-between items-center shadow-lg">
                    <span class="text-gray-500 text-sm font-medium">ë¡œê·¸ì¸ ê³„ì •</span>
                    <span class="text-white font-bold text-base" id="user-email">...</span>
                </div>

                <!-- Actions -->
                <button onclick="location.href='/'"
                    class="w-full py-4 rounded-xl bg-slate-800 hover:bg-slate-700 text-gray-300 font-bold transition-all border border-slate-700 hover:border-slate-600 shadow-lg">
                    ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="firebase_config.js"></script>

    <script>
        // Wait for auth
        if (typeof auth !== 'undefined') {
            auth.onAuthStateChanged(async (user) => {
                if (!user) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
                    window.location.href = '/login';
                    return;
                }

                try {
                    // Fetch User Data (Compat)
                    const userDoc = await db.collection("users").doc(user.uid).get();

                    if (!userDoc.exists) {
                        alert('ê³„ì • ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }

                    const userData = userDoc.data();

                    // Check Plan Status
                    if (userData.plan === 'free' || !userData.plan) {
                        document.getElementById('no-license').classList.remove('hidden');
                        return;
                    }

                    // Valid Paid User
                    document.getElementById('license-info').classList.remove('hidden');

                    // Display Plan Info
                    let displayPlan = userData.planName || (userData.plan ? userData.plan.toUpperCase() + ' PLAN' : 'PRO PLAN');

                    // ë§Œì•½ planNameì´ 'PRO Plan' ë“±ìœ¼ë¡œ ì˜ëª» ì €ì¥ë˜ì–´ ìˆì–´ë„ plan í•„ë“œê°€ 'lite'ë©´ ê°•ì œë¡œ ìˆ˜ì •í•˜ì—¬ í‘œì‹œ
                    if (userData.plan === 'lite') {
                        displayPlan = 'LITE PLAN';
                    } else if (userData.plan === 'pro') {
                        displayPlan = 'PRO PLAN';
                    } else if (userData.plan === 'master') {
                        displayPlan = 'MASTER PLAN';
                    }

                    document.getElementById('plan-name').textContent = displayPlan.toUpperCase();
                    document.getElementById('user-email').textContent = user.email;

                    // Display Expiry Date
                    if (userData.expiryDate) {
                        try {
                            const expDate = userData.expiryDate.toDate(); // Firestore Timestamp to JS Date
                            // Formatter: YYYY.MM.DD
                            const expStr = expDate.getFullYear() + '.' +
                                String(expDate.getMonth() + 1).padStart(2, '0') + '.' +
                                String(expDate.getDate()).padStart(2, '0');

                            document.getElementById('expiry-display').textContent = expStr + " ê¹Œì§€";

                            // Check for Expiration
                            const now = new Date();
                            if (expDate < now) {
                                const badge = document.querySelector('#license-info .bg-green-500\\/10');
                                badge.className = 'inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-bold bg-red-500/10 text-red-400 border border-red-500/20';
                                badge.innerHTML = '<span class="w-2 h-2 rounded-full bg-red-500"></span> ë§Œë£Œë¨ (ì¬ê²°ì œ í•„ìš”)';
                                document.getElementById('expiry-display').classList.add('text-red-400');
                            }

                        } catch (e) { console.error("Date Parse Error", e); }
                    } else {
                        document.getElementById('expiry-display').textContent = "ë¬´ì œí•œ / ì •ë³´ ì—†ìŒ";
                    }

                    // Expiry Check (Optional)
                    /*
                    if (userData.expiryDate && userData.expiryDate.toDate() < new Date()) {
                         document.getElementById('status-badge').className = '... bg-red-500 ...';
                         document.getElementById('status-badge').textContent = 'EXPIRED (ë§Œë£Œë¨)';
                    }
                    */

                } catch (error) {
                    console.error("Error loading info:", error);
                    alert("ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        }
    </script>
    </div>
    </div>
    <!-- FOOTER -->
    <footer class="mt-auto border-t border-slate-800 bg-slate-900 py-8 text-center text-xs text-gray-500 w-full"
        style="position: relative; z-index: 10;">
        <div class="container-custom space-y-2">
            <p><span class="font-bold text-gray-400">ë¦¬ì¹´ì˜¤í† í”Œëœ</span> | ëŒ€í‘œì: ì¡°í™ì²  | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 325-60-00844</p>
            <p>ì£¼ì†Œ: ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬ ì‹ í¥ë¡œ 40, 709í˜¸(ì‹¬ê³¡ë™, ë””ì˜¤ìŠ¤ë¹Œ)</p>
            <p>ê³ ê°ì„¼í„°: <a href="mailto:jhxox666@naver.com" class="text-blue-400 hover:underline">jhxox666@naver.com</a>
            </p>
            <p class="mt-4 copyright">Â© 2026 Ricar Auto Plan. All rights reserved.</p>
        </div>
    </footer>
</body>

</html>