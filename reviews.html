<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>사용자 후기 - RicarBot</title>
    <!-- BEGIN: Scripts and Fonts -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <style data-purpose="typography">
        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
        }
    </style>
    <style data-purpose="custom-layout">
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .star-gold {
            color: #fbbf24;
        }

        .modal-overlay {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        gold: '#fbbf24',
                    }
                }
            }
        }
    </script>
    <!-- END: Scripts and Fonts -->
</head>

<body class="antialiased overflow-x-hidden pt-16">
    <!-- BEGIN: MainHeader -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 fixed top-0 left-0 right-0 z-50"
        data-purpose="navigation">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center gap-2 cursor-pointer" onclick="location.href='index.html'">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-xl">R</span>
                    </div>
                    <span class="text-xl font-bold tracking-tight text-primary">RicarBot</span>
                </div>

                <nav class="hidden md:flex items-center gap-8">
                    <a href="index.html"
                        class="text-sm font-medium text-slate-500 hover:text-primary transition-colors">홈</a>
                    <a href="guide.html"
                        class="text-sm font-medium text-slate-500 hover:text-primary transition-colors">가이드</a>
                    <a href="reviews.html" class="text-sm font-bold text-primary border-b-2 border-primary pb-1">이용
                        후기</a>
                </nav>

                <!-- CTA / Auth -->
                <div id="nav-auth-section" class="flex items-center gap-4">
                    <button
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-semibold rounded-full text-white bg-primary hover:bg-slate-800 transition-all"
                        onclick="openWriteModal()" id="write-btn" style="display:none;">
                        후기 작성하기
                    </button>
                    <a href="login.html" class="text-sm font-medium text-slate-500 hover:text-primary transition-colors"
                        id="login-link">로그인</a>
                </div>
            </div>
        </div>
    </header>
    <!-- END: MainHeader -->

    <main>
        <!-- BEGIN: HeroSection -->
        <section class="relative py-16 sm:py-24 bg-white" data-purpose="hero-section">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-primary tracking-tight mb-6">
                    사용자 후기
                </h1>
                <p class="max-w-2xl mx-auto text-lg text-slate-600 leading-relaxed">
                    리카봇과 함께 비즈니스의 효율을 높인 고객님들의 솔직한 이야기를 확인해보세요.<br class="hidden sm:inline" />
                    수천 명의 자동차 딜러와 자영업자가 리카봇의 스마트한 자동화를 경험하고 있습니다.
                </p>
            </div>
        </section>
        <!-- END: HeroSection -->

        <!-- BEGIN: RewardBanner -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16" data-purpose="promotion-banner">
            <div class="relative overflow-hidden rounded-3xl bg-primary px-6 py-10 sm:px-12 sm:py-16 shadow-2xl">
                <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-8">
                    <div>
                        <span
                            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-gold text-primary mb-4">REWARD</span>
                        <h2 class="text-2xl sm:text-3xl font-bold text-white mb-2">리커봇 사용 후기 작성 이벤트</h2>
                        <p class="text-slate-300">정성스러운 후기를 남겨주시는 모든 분들께 <span class="text-gold font-bold">7일 무료
                                이용권</span>을 드립니다.</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right hidden sm:block">
                            <p class="text-slate-400 text-sm">상시 진행 중</p>
                            <p class="text-white font-medium">1계정 1회 참여 가능</p>
                        </div>
                        <button
                            class="bg-white text-primary px-6 py-3 rounded-xl font-bold hover:bg-slate-100 transition-colors shadow-lg"
                            onclick="openWriteModal()">
                            지금 참여하기
                        </button>
                    </div>
                </div>
                <!-- Decorative elements -->
                <div class="absolute -right-10 -bottom-10 w-64 h-64 bg-slate-800 rounded-full opacity-50 blur-3xl">
                </div>
                <div class="absolute -left-10 -top-10 w-48 h-48 bg-slate-700 rounded-full opacity-30 blur-3xl"></div>
            </div>
        </section>
        <!-- END: RewardBanner -->

        <!-- BEGIN: ReviewGrid -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24" data-purpose="review-list-container">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-xl font-bold text-primary">실시간 후기</h3>
                <div class="flex gap-2">
                    <select class="rounded-lg border-slate-200 text-sm focus:ring-primary focus:border-primary">
                        <option>최신순</option>
                        <option>평점 높은순</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="review-list">
                <!-- Loading State -->
                <div class="col-span-full py-20 text-center">
                    <div
                        class="inline-block w-8 h-8 border-4 border-slate-200 border-t-primary rounded-full animate-spin">
                    </div>
                    <p class="mt-4 text-slate-400">후기를 불러오고 있습니다...</p>
                </div>
            </div>
        </section>
        <!-- END: ReviewGrid -->
    </main>

    <!-- BEGIN: ReviewModal -->
    <div aria-labelledby="modal-title" aria-modal="true" class="hidden fixed inset-0 z-[100] overflow-y-auto"
        id="review-modal" role="dialog">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div aria-hidden="true" class="modal-overlay fixed inset-0 transition-opacity" onclick="closeWriteModal()">
            </div>
            <span aria-hidden="true" class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>
            <div
                class="inline-block align-bottom bg-white rounded-3xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-6 pt-8 pb-6 sm:p-10">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-primary" id="modal-title">후기 작성</h3>
                        <button class="text-slate-400 hover:text-slate-600" onclick="closeWriteModal()">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2" for="review-title">한 줄
                                제목</label>
                            <input
                                class="block w-full rounded-xl border-slate-200 focus:ring-primary focus:border-primary text-sm"
                                id="review-title" placeholder="후기 제목을 입력하세요." type="text" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">만족도 별점</label>
                            <div class="flex gap-2" id="star-container">
                                <button class="star-gold" onclick="setRating(1)"><span
                                        class="material-symbols-outlined text-4xl">star</span></button>
                                <button class="star-gold" onclick="setRating(2)"><span
                                        class="material-symbols-outlined text-4xl">star</span></button>
                                <button class="star-gold" onclick="setRating(3)"><span
                                        class="material-symbols-outlined text-4xl">star</span></button>
                                <button class="star-gold" onclick="setRating(4)"><span
                                        class="material-symbols-outlined text-4xl">star</span></button>
                                <button class="star-gold" onclick="setRating(5)"><span
                                        class="material-symbols-outlined text-4xl">star</span></button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2" for="review-content">상세
                                후기</label>
                            <textarea
                                class="block w-full rounded-xl border-slate-200 focus:ring-primary focus:border-primary text-sm"
                                id="review-content" placeholder="리커봇 사용 후 어떤 점이 개선되었나요? 솔직한 후기를 10자 이상 남겨주세요."
                                rows="4"></textarea>
                        </div>
                        <button
                            class="w-full bg-primary text-white font-bold py-4 rounded-xl hover:bg-slate-800 transition-colors shadow-lg"
                            onclick="submitReview()" id="submit-btn">
                            후기 등록하고 7일 연장 받기
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END: ReviewModal -->

    <!-- BEGIN: Footer -->
    <footer class="bg-white border-t border-slate-200 py-12">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center sm:text-left flex flex-col sm:flex-row justify-between items-center gap-8">
            <div>
                <p class="text-slate-500 text-sm">© 2026 RicarBot Inc. All rights reserved.</p>
                <p class="text-xs text-slate-400 mt-1">대표: 조홍철 | 사업자: 325-60-00844 | jhxox666@naver.com</p>
            </div>
            <div class="flex gap-4">
                <a href="privacy_policy_ricarautoplan_multi_pg_nolist.html"
                    class="text-xs text-slate-400 hover:underline">개인정보처리방침</a>
            </div>
        </div>
    </footer>
    <!-- END: Footer -->

    <!-- Firebase Script -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="firebase_config.js"></script>
    <script src="common.js"></script>

    <script>
        let currentUser = null;
        let userPlan = null;
        let currentRating = 5;
        let isEditing = false;
        let editDocId = null;

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof auth !== 'undefined') {
                auth.onAuthStateChanged(async (user) => {
                    currentUser = user;
                    const loginLink = document.getElementById('login-link');
                    const writeBtn = document.getElementById('write-btn');

                    if (user) {
                        loginLink.textContent = '로그아웃';
                        loginLink.href = '#';
                        loginLink.onclick = () => { auth.signOut().then(() => location.reload()); };

                        // Check plan for write permission
                        if (typeof db !== 'undefined') {
                            const doc = await db.collection('users').doc(user.uid).get();
                            if (doc.exists) {
                                userPlan = doc.data();
                                if (userPlan.plan && userPlan.plan !== 'free') {
                                    writeBtn.style.display = 'inline-flex';
                                }
                            }
                        }
                    } else {
                        loginLink.textContent = '로그인';
                        loginLink.href = 'login.html';
                        writeBtn.style.display = 'none';
                    }
                });
            }
            loadReviews();
            setRating(5);
        });

        function loadReviews() {
            const FEATURED_REVIEWS = [
                { authorName: "김*훈 딜러", rating: 5, title: "업무 효율 30% 상승", content: "자동 응답 기능 덕분에 새벽 문의도 놓치지 않고 있습니다. 매우 만족합니다.", date: "2024.11.20", plan: "PRO" },
                { authorName: "이*영 대표", rating: 4, title: "직관적인 UI", content: "직원들이 금방 적응하여 사용 중입니다. B2B 대량 관리에 필수입니다.", date: "2024.11.18", plan: "LITE" },
                { authorName: "박*준 딜러", rating: 5, title: "상담 로그의 힘", content: "상담 로그가 남아서 추후 관리가 정말 편합니다. 믿고 씁니다.", date: "2024.11.15", plan: "PRO" }
            ];

            const list = document.getElementById('review-list');

            if (typeof db === 'undefined') {
                renderList(FEATURED_REVIEWS);
                return;
            }

            db.collection('reviews').orderBy('createdAt', 'desc').limit(20).onSnapshot((snapshot) => {
                let dbReviews = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    dbReviews.push({
                        id: doc.id,
                        authorName: data.authorName,
                        rating: data.rating,
                        title: data.title,
                        content: data.content,
                        date: data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString() : '최근',
                        plan: data.planName || 'PRO',
                        uid: data.uid
                    });
                });
                renderList([...dbReviews, ...FEATURED_REVIEWS]);
            });
        }

        function renderList(reviews) {
            const list = document.getElementById('review-list');
            list.innerHTML = reviews.map(r => `
                <article class="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow flex flex-col h-full relative">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex gap-0.5">
                            ${Array(5).fill(0).map((_, i) => `
                                <span class="material-symbols-outlined text-xl ${i < r.rating ? 'star-gold fill-1' : 'text-slate-200'}">star</span>
                            `).join('')}
                        </div>
                        <div class="flex items-center text-xs font-semibold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-md">
                            ${r.plan} 사용자
                        </div>
                    </div>
                    <h4 class="font-bold text-slate-900 mb-2 truncate">${escapeHtml(r.title)}</h4>
                    <p class="text-slate-700 text-sm leading-relaxed mb-6 flex-grow">
                        ${escapeHtml(r.content)}
                    </p>
                    <div class="flex items-center gap-3 pt-4 border-t border-slate-100 mt-auto">
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-400">
                             ${r.authorName[0]}
                        </div>
                        <div>
                            <p class="font-bold text-sm text-primary">${r.authorName}</p>
                            <p class="text-xs text-slate-500">${r.date}</p>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        function openWriteModal() {
            if (!currentUser) return alert("로그인이 필요합니다.");
            if (!userPlan || userPlan.plan === 'free') return alert("유료 플랜 사용자만 작성 가능합니다.");

            isEditing = false;
            editDocId = null;
            document.getElementById('modal-title').innerText = "후기 작성";
            document.getElementById('review-title').value = '';
            document.getElementById('review-content').value = '';
            setRating(5);
            document.getElementById('review-modal').classList.remove('hidden');
        }

        function closeWriteModal() {
            document.getElementById('review-modal').classList.add('hidden');
        }

        function setRating(rating) {
            currentRating = rating;
            const stars = document.getElementById('star-container').children;
            for (let i = 0; i < 5; i++) {
                stars[i].querySelector('span').style.fontVariationSettings = (i < rating) ? "'FILL' 1" : "'FILL' 0";
                stars[i].classList.toggle('text-slate-200', i >= rating);
                stars[i].classList.toggle('star-gold', i < rating);
            }
        }

        async function submitReview() {
            const title = document.getElementById('review-title').value.trim();
            const content = document.getElementById('review-content').value.trim();

            if (!title) return alert("제목을 입력해주세요.");
            if (content.length < 10) return alert("내용을 10자 이상 작성해주세요.");

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = '등록 중...';

            try {
                const authorName = currentUser.email.split('@')[0].substring(0, 2) + '***';
                await db.collection('reviews').add({
                    uid: currentUser.uid,
                    authorName: authorName,
                    planName: userPlan.planName || userPlan.plan.toUpperCase(),
                    title: title,
                    content: content,
                    rating: currentRating,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("후기가 등록되었습니다! 감사의 의미로 이용 기간이 7일 연장됩니다.");
                closeWriteModal();
            } catch (e) {
                alert("등록 실패: " + e.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '후기 등록 완료';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>

</html>