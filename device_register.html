<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기기 등록 - 리카오토플랜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="base.css" rel="stylesheet">
    <script src="common.js"></script>
</head>

<body class="flex items-center justify-center min-h-screen p-4">
    <div class="card max-w-md w-full">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-2xl font-black text-white">기기 등록</h1>
            <a href="license.html" class="text-sm text-gray-400 hover:text-white">← 돌아가기</a>
        </div>

        <!-- STATE 1: Registration Form -->
        <div id="register-form" class="space-y-6">
            <div class="text-center py-6">
                <div
                    class="w-20 h-20 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                    <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                        </path>
                    </svg>
                </div>
                <p class="text-white font-bold mb-1">현재 사용 중인 기기를 등록합니다.</p>
                <p class="text-xs text-gray-500">등록 후 프로그램을 즉시 사용할 수 있습니다.</p>
            </div>

            <div>
                <label class="block text-sm text-gray-400 mb-1">기기 별칭 (선택)</label>
                <input type="text" id="input-dev-name" class="input-field" placeholder="예: 내 맥북, 홍길동의 PC">
            </div>

            <button onclick="registerDevice()" class="btn-primary">이 기기 등록하기 (1/1)</button>
        </div>

        <!-- STATE 2: Already Registered -->
        <div id="registered-view" class="hidden text-center space-y-6">
            <div class="w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>

            <h2 class="text-xl font-bold text-white">인증된 기기입니다</h2>

            <div class="bg-slate-950 p-6 rounded-xl border border-blue-500/30">
                <p class="text-xs text-blue-400 font-bold mb-2">CURRENT DEVICE</p>
                <h3 class="text-xl font-bold text-white mb-1" id="view-name">...</h3>
                <p class="text-xs font-mono text-gray-500" id="view-id">Device ID: ...</p>
                <p class="text-xs text-gray-500 mt-2" id="view-date">RegDate: ...</p>
            </div>

            <button onclick="unregisterDevice()"
                class="w-full py-4 rounded-xl border border-red-900/50 text-red-500 font-bold text-sm hover:bg-red-900/10 transition">
                기기 등록 해제
            </button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', checkStatus);

        function checkStatus() {
            const device = Utils.getStorage(STORAGE_KEYS.DEVICE);
            if (device) {
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('registered-view').classList.remove('hidden');

                document.getElementById('view-name').textContent = device.name;
                document.getElementById('view-id').textContent = device.id;
                document.getElementById('view-date').textContent = Utils.formatDate(device.regDate);
            } else {
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('registered-view').classList.add('hidden');
            }
        }

        function registerDevice() {
            const nameInput = document.getElementById('input-dev-name').value.trim();
            const deviceName = nameInput || '알 수 없는 기기';

            const deviceInfo = {
                id: Utils.generateDeviceId(),
                name: deviceName,
                regDate: new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language
            };

            if (confirm(`'${deviceName}' 기기를 등록하시겠습니까?`)) {
                Utils.setStorage(STORAGE_KEYS.DEVICE, deviceInfo);
                alert('기기 등록이 완료되었습니다.\n라이선스가 활성화되었습니다.');
                checkStatus();
            }
        }

        function unregisterDevice() {
            if (confirm('정말 기기 등록을 해제하시겠습니까?\n프로그램 사용이 중지됩니다.')) {
                localStorage.removeItem(STORAGE_KEYS.DEVICE);
                alert('해제되었습니다.');
                checkStatus();
            }
        }
    </script>
</body>

</html>